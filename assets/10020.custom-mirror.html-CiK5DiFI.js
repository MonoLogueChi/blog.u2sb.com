import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,b as n,a as r,e as a,d as o,w as c,r as p,o as d}from"./app-CnYccAH2.js";const l="/assets/0-Dz3CEold.png",m="/assets/1-B1gIzCeG.png",u="/assets/3-DaFAap6r.png",h="/assets/4-J2WYC9qP.png",b="/assets/5-CZzzdryU.png",g="/assets/6-B8Qwdj9f.png",f="/assets/7-3tK_NhgY.png",v="/assets/8-QABC77p9.png",k="/assets/9-BT8w9x2M.png",y={};function x(_,e){const i=p("RouteLink");return d(),t("div",null,[e[2]||(e[2]=n("p",null,"最近发现服务器上一些服务已经没用了，趁着十一假期整理一下，顺便研究一下腾讯云怎么使用自定义的镜像安装系统。",-1)),n("blockquote",null,[n("p",null,[e[1]||(e[1]=a("如果不需要自己定义镜像内容，只是需要原版镜像，可以看")),o(i,{to:"/2021/custom-mirror.html"},{default:c(()=>e[0]||(e[0]=[a("这篇文章")])),_:1})])]),e[3]||(e[3]=r('<p>不得不吐槽一下，腾讯云的官方镜像实在是太少了，不像阿里那么丰富，对个人来说也许不怎么友好，但是对企业来说那就无所谓了。</p><h2 id="工具" tabindex="-1"><a class="header-anchor" href="#工具"><span>工具</span></a></h2><ul><li>系统：win 10（家庭版不行）</li><li>虚拟机：Hyper-V</li><li>Linux 镜像文件（以 Debian10 为例）</li></ul><h2 id="文档" tabindex="-1"><a class="header-anchor" href="#文档"><span>文档</span></a></h2><p>首先先看一下腾讯云的<a href="https://cloud.tencent.com/document/product/213/4942" target="_blank" rel="noopener noreferrer">官方文档</a>。如果是不太熟悉虚拟化的朋友读下来，可能就是感觉云里雾里，不知道在讲什么。下面我就用一种很简单的方法去操作一边，演示怎么使用自定义的镜像。</p><h2 id="创建快照" tabindex="-1"><a class="header-anchor" href="#创建快照"><span>创建快照</span></a></h2><p>数据才是最重要的，使用自定义镜像装系统之前一定要创建快照。这一步你可以在后面制作完镜像以后再去做，但是重装系统之前一定要做。</p><figure><img src="'+l+'" alt="创建快照" tabindex="0" loading="lazy"><figcaption>创建快照</figcaption></figure><h2 id="基本要求" tabindex="-1"><a class="header-anchor" href="#基本要求"><span>基本要求</span></a></h2><p>还是看文档，确定一下基本要求，要满足这些要求才可以正常制作镜像。</p><figure><img src="'+m+'" alt="镜像要求" tabindex="0" loading="lazy"><figcaption>镜像要求</figcaption></figure><p>排除操作系统不说，镜像格式需要注意一下，这次我打算选用 VHD 格式。<br> 文件系统，不能使用 GPT 分区，这个一定要注意，这是一个坑。</p><h2 id="具体过程" tabindex="-1"><a class="header-anchor" href="#具体过程"><span>具体过程</span></a></h2><h3 id="创建虚拟机" tabindex="-1"><a class="header-anchor" href="#创建虚拟机"><span>创建虚拟机</span></a></h3><figure><img src="'+u+'" alt="创建虚拟机" tabindex="0" loading="lazy"><figcaption>创建虚拟机</figcaption></figure><p>一定要注意，创建虚拟机要选择<strong>第一代</strong>，还记得前面提到的条件吗，虚拟硬盘要 MBR 分区表，不能使用 GPT 分区表。</p><h3 id="安装系统" tabindex="-1"><a class="header-anchor" href="#安装系统"><span>安装系统</span></a></h3><p>创建完虚拟机之后挂载已经下载好的镜像文件，由于 Debian10 镜像在第一代虚拟机里有问题，所以我用的 Live 版的 Debian10 镜像。<br> 附 Debian10 下载地址：<a href="https://mirrors.cloud.tencent.com/debian-cd" target="_blank" rel="noopener noreferrer">https://mirrors.cloud.tencent.com/debian-cd/</a> （腾讯源，下载速度还可以）。</p><figure><img src="'+h+`" alt="安装系统" tabindex="0" loading="lazy"><figcaption>安装系统</figcaption></figure><h3 id="必要的配置" tabindex="-1"><a class="header-anchor" href="#必要的配置"><span>必要的配置</span></a></h3><p>这一部分请详细阅读前面的官方文档，如果文档和本文有冲突，请以官方文档为准。</p><ul><li>安装一些常用的工具，比如 <code>sudo</code>、<code>vim</code>等；</li><li>更新系统；</li><li>安装<code>cloud-init</code>，这一部分详见：<a href="https://cloud.tencent.com/document/product/213/12587" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/document/product/213/12587</a></li></ul><p>这里重点说一下安装<code>cloud-init</code>，我选择的是自动安装方式：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo apt-get install cloud-init</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Debian 不需要修改<code>/etc/cloud/cloud.cfg</code>就可以直接使用，其他 Linux 没有尝试过。当然如果你愿意改那就改，比如说改一下镜像源等等，但是我相信如果你能知道怎么修改，就已经不需要看本文了。</p><p>后面几步操作我也不太明白具体是为了什么（仅 Debian 和 Ubuntu 需要，其他系统不清楚），反正按照官方要求删几个文件，改一个文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cloud-init init --local</span></span>
<span class="line"><span>rm -rf /var/lib/cloud</span></span>
<span class="line"><span></span></span>
<span class="line"><span>rm -rf /etc/network/interfaces.d/50-cloud-init.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改<code>/etc/network/interfaces</code>为：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># This file describes the network interfaces available on your system</span></span>
<span class="line"><span># and how to activate them. For more information, see interfaces(5).</span></span>
<span class="line"><span>source /etc/network/interfaces.d/*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也就是把后面的那部分删掉。</p><p>修改完之后直接关机。</p><h3 id="转换虚拟硬盘格式" tabindex="-1"><a class="header-anchor" href="#转换虚拟硬盘格式"><span>转换虚拟硬盘格式</span></a></h3><p>Hyper-V 虚拟机的默认硬盘格式是 VHDX，需要转换成 VHD，Hyper-V 虚拟机管理器本身就有这个功能，所以不需要再去额外安装其他的软件了。</p><p>如果有检查点的话，需要先删除检查点，右键点击然后选删除就可以了，不删除检查点是不能操作虚拟硬盘的。</p><p>在虚拟机设置里选中虚拟硬盘，转换之前先压缩一下（虽然什么用也没有，心理安慰）。</p><figure><img src="`+b+'" alt="转换格式" tabindex="0" loading="lazy"><figcaption>转换格式</figcaption></figure><figure><img src="'+g+'" alt="转换格式" tabindex="0" loading="lazy"><figcaption>转换格式</figcaption></figure><figure><img src="'+f+'" alt="转换格式" tabindex="0" loading="lazy"><figcaption>转换格式</figcaption></figure><figure><img src="'+v+'" alt="转换格式" tabindex="0" loading="lazy"><figcaption>转换格式</figcaption></figure><p>保存好导出的虚拟硬盘，等下需要上传这个东西。</p><h3 id="导入自定义镜像" tabindex="-1"><a class="header-anchor" href="#导入自定义镜像"><span>导入自定义镜像</span></a></h3><p>按照<a href="https://cloud.tencent.com/document/product/213/4945#.E5.AF.BC.E5.85.A5.E6.AD.A5.E9.AA.A4" target="_blank" rel="noopener noreferrer">官方文档</a>给出的导入步骤，一部一部走下来就可以了。</p><p>记住上传的文件一定要有<code>公有读</code>权限。</p><figure><img src="'+k+`" alt="转换格式" tabindex="0" loading="lazy"><figcaption>转换格式</figcaption></figure><p>我暂时不能确定是否是必须上传的<code>OOS</code>上，其他的链接没有尝试过，如果有大佬愿意尝试的话，可以试一下上传到其他服务器，看看分享出来的链接能不能用。</p><h2 id="安装系统-1" tabindex="-1"><a class="header-anchor" href="#安装系统-1"><span>安装系统</span></a></h2><p>这一步没啥说的，常规操作，记得一定要先创建快照，一定要先做好备份。</p><p>装完系统以后再修改一下软件源，改为腾讯云的好了，例如 Debian10 就修改为：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>deb https://mirrors.cloud.tencent.com/debian buster main contrib non-free</span></span>
<span class="line"><span>deb https://mirrors.cloud.tencent.com/debian buster-updates main contrib non-free</span></span>
<span class="line"><span>deb https://mirrors.cloud.tencent.com/debian buster-backports main contrib non-free</span></span>
<span class="line"><span>deb https://mirrors.cloud.tencent.com/debian buster-proposed-updates main contrib non-free</span></span>
<span class="line"><span>#deb-src https://mirrors.cloud.tencent.com/debian buster main contrib non-free</span></span>
<span class="line"><span>#deb-src https://mirrors.cloud.tencent.com/debian buster-updates main contrib non-free</span></span>
<span class="line"><span>#deb-src https://mirrors.cloud.tencent.com/debian buster-backports main contrib non-free</span></span>
<span class="line"><span>#deb-src https://mirrors.cloud.tencent.com/debian buster-proposed-updates main contrib non-free</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deb https://mirrors.cloud.tencent.com/debian-security buster/updates main</span></span>
<span class="line"><span>#deb-src https://mirrors.cloud.tencent.com/debian-security buster/updates main</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,49))])}const D=s(y,[["render",x]]),F=JSON.parse('{"path":"/2019/10020.custom-mirror.html","title":"腾讯云使用自定义镜像","lang":"zh-CN","frontmatter":{"title":"腾讯云使用自定义镜像","date":"2019-10-02T22:15:35.000Z","tag":["建站笔记"],"keywords":"腾讯云 自定义镜像 Debian10","comments":true,"redirectFrom":["/2019/custom-mirror.html"],"description":"最近发现服务器上一些服务已经没用了，趁着十一假期整理一下，顺便研究一下腾讯云怎么使用自定义的镜像安装系统。","head":[["meta",{"property":"og:url","content":"https://blog.u2sb.com/2019/10020.custom-mirror.html"}],["meta",{"property":"og:site_name","content":"叉叉白"}],["meta",{"property":"og:title","content":"腾讯云使用自定义镜像"}],["meta",{"property":"og:description","content":"最近发现服务器上一些服务已经没用了，趁着十一假期整理一下，顺便研究一下腾讯云怎么使用自定义的镜像安装系统。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-06T05:10:35.000Z"}],["meta",{"property":"article:tag","content":"建站笔记"}],["meta",{"property":"article:published_time","content":"2019-10-02T22:15:35.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-06T05:10:35.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"腾讯云使用自定义镜像\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-10-02T22:15:35.000Z\\",\\"dateModified\\":\\"2025-04-06T05:10:35.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"MonoLogueChi\\",\\"url\\":\\"https://blog.u2sb.com\\"}]}"]]},"git":{"createdTime":1743916235000,"updatedTime":1743916235000,"contributors":[{"name":"MonoLogueChi","username":"MonoLogueChi","email":"xxwhite@foxmail.com","commits":1,"url":"https://github.com/MonoLogueChi"}]},"readingTime":{"minutes":4.34,"words":1301},"filePathRelative":"2019/10020.custom-mirror.md","localizedDate":"2019年10月3日","excerpt":"<p>最近发现服务器上一些服务已经没用了，趁着十一假期整理一下，顺便研究一下腾讯云怎么使用自定义的镜像安装系统。</p>\\n","autoDesc":true}');export{D as comp,F as data};
